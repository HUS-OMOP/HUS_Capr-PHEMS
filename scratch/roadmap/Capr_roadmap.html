<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Martin Lavallee">
<meta name="author" content="Adam Black">

<title>Capr Development Roadmap</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
</style>


<script src="Capr_roadmap_files/libs/clipboard/clipboard.min.js"></script>
<script src="Capr_roadmap_files/libs/quarto-html/quarto.js"></script>
<script src="Capr_roadmap_files/libs/quarto-html/popper.min.js"></script>
<script src="Capr_roadmap_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Capr_roadmap_files/libs/quarto-html/anchor.min.js"></script>
<link href="Capr_roadmap_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Capr_roadmap_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Capr_roadmap_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Capr_roadmap_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Capr_roadmap_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


<link rel="stylesheet" href="styles.css">
</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#what-does-the-package-do" id="toc-what-does-the-package-do" class="nav-link active" data-scroll-target="#what-does-the-package-do">What does the package do</a></li>
  <li><a href="#applications-of-capr" id="toc-applications-of-capr" class="nav-link" data-scroll-target="#applications-of-capr">Applications of Capr</a></li>
  <li><a href="#where-does-capr-start-and-where-does-it-stop" id="toc-where-does-capr-start-and-where-does-it-stop" class="nav-link" data-scroll-target="#where-does-capr-start-and-where-does-it-stop">Where does Capr start and where does it stop?</a>
  <ul class="collapse">
  <li><a href="#starting-point" id="toc-starting-point" class="nav-link" data-scroll-target="#starting-point">Starting point</a></li>
  <li><a href="#end-point" id="toc-end-point" class="nav-link" data-scroll-target="#end-point">End point</a></li>
  </ul></li>
  <li><a href="#version-2" id="toc-version-2" class="nav-link" data-scroll-target="#version-2">Version 2</a>
  <ul class="collapse">
  <li><a href="#community-feedback" id="toc-community-feedback" class="nav-link" data-scroll-target="#community-feedback">Community Feedback</a></li>
  <li><a href="#release-roadmap" id="toc-release-roadmap" class="nav-link" data-scroll-target="#release-roadmap">Release Roadmap</a>
  <ul class="collapse">
  <li><a href="#version-2.0-new-and-improved" id="toc-version-2.0-new-and-improved" class="nav-link" data-scroll-target="#version-2.0-new-and-improved">Version 2.0 (New and improved)</a></li>
  <li><a href="#version-2.1-finishing-touches-to-v2-base" id="toc-version-2.1-finishing-touches-to-v2-base" class="nav-link" data-scroll-target="#version-2.1-finishing-touches-to-v2-base">Version 2.1 (finishing touches to v2 base)</a></li>
  <li><a href="#version-2.2-and-beyond-new-functionality" id="toc-version-2.2-and-beyond-new-functionality" class="nav-link" data-scroll-target="#version-2.2-and-beyond-new-functionality">Version 2.2 and beyond (new functionality)</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Capr Development Roadmap</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-contents">
             <p>Martin Lavallee </p>
             <p>Adam Black </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="what-does-the-package-do" class="level1 page-columns page-full">
<h1>What does the package do</h1>

<div class="no-row-height column-margin column-container"><div class="">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="caperFlower.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption"><code>Capr</code> (pronounced: caper)</figcaption><p></p>
</figure>
</div>
</div></div><p>Capr is a programmatic interface to defining cohort definition for the OMOP CDM. Capr builds a representation of a cohort through R that can be seralized to json. The json structure can be imported into ATLAS. This structure follows that of circe-be, that object representation of cohort definitions in OHDSI. A valid circe-be json can be seralized into ohdsisql, a parameterized version of sql that builds cohort under the assumptions of the OMOP CDM structure. The advantage of Capr is that a user has more control over the underlying pieces of a valid circe-be structure, which enables us to create cohort templates to iterate across multiple variations of a skeletal cohort definition.</p>
</section>
<section id="applications-of-capr" class="level1">
<h1>Applications of Capr</h1>
<p>The main applications of Capr are as follows:</p>
<ol type="1">
<li><strong>Construction</strong>: defining a cohort definition in R and the ability to serialize this into a valid circe-be json structure.
<ol type="a">
<li><strong>Templating</strong>: within construction comes the idea of templating cohort definitions. A user can define a function using Capr constructors to build various iterations of a skeleton definition. This is seen as the primary use case of Capr.</li>
<li><strong>Import and modify</strong>: a user can import a circe-be json into R using Capr and modify its structure. We plan to add some modification functionality to Capr (such as combining inclusion rules of two cohort definitions) but otherwise we encourage users to construct novel pieces of the cohort definition and modify in place.</li>
</ol></li>
<li><strong>Inquire</strong> (planned feature): the idea of inquire is to see, how much data is available in the active database based on a sub-component of a cohort definition. Using the inquire functions will help users see the magnitude of adding complexity to a definition without building the entire definition.</li>
<li><strong>Describe</strong> (planned feature): providing a layman interpretation of a cohort definition through text and figures. A future implementation plans to allow users to:
<ol type="a">
<li>console print a Capr object to provide a simple explanation of the object,<br>
</li>
<li>provide a markdown representation of the cohort and</li>
<li>provide a graphical figure of the cohort.</li>
</ol></li>
</ol>
</section>
<section id="where-does-capr-start-and-where-does-it-stop" class="level1">
<h1>Where does Capr start and where does it stop?</h1>
<section id="starting-point" class="level2">
<h2 class="anchored" data-anchor-id="starting-point">Starting point</h2>
<p>Ideally, Capr should be used in tandem with a connection to an OMOP vocabulary. Connection to an OMOP vocabulary can be done through DatabaseConnector or CDMConnector. This allows users to lookup concepts before applying them in Capr objects. Capr does not provide functionality to optimize concept lookup; this is a feature passed to other OHDSI software. Capr assumes the list of concepts as inputs.</p>
</section>
<section id="end-point" class="level2">
<h2 class="anchored" data-anchor-id="end-point">End point</h2>
<p>Capr stops upon development of the json structure, which is typically saved as a file in a directory. The previous version of Capr allowed for the user to create the ohdsiSql via CirceR. However, this was deemed an overlap between other OHDSI R packages (CirceR, CohortGenerator etc.) and it felt more appropriate for the Capr process to end at building the json file. Ultimately the item that is passed across the OHDSI network is the cohort definition json. The json file can be upload into ATLAS or into R where the ohdsiSql can be built using CirceR. Json is a straight input to build the sql, so it was deemed the minimially sufficient output needed. We intend to draw distinct lines between OHDSI software in order to improve standard workflows, that are either site internal or for network studies.</p>
</section>
</section>
<section id="version-2" class="level1">
<h1>Version 2</h1>
<p>Capr version 2 entails an overhaul of the user-interface. It follows a shiny style syntax to defining cohort definitions instead of using piping. Version 2 maintains all the features available from version 1 and has potential expansions.</p>
<section id="community-feedback" class="level2">
<h2 class="anchored" data-anchor-id="community-feedback">Community Feedback</h2>
<p>Prior to release on <code>main</code> branch of Capr in HADES, we will push Capr v2.0 to the <code>develop</code> branch in HADES and allow for 2 weeks of testing from HADES contributors. We will open a discussions page for testers to provide feedback and suggestions of Capr v2.0. We ask for volunteers who would be willing beta test Capr.</p>
<p>After the beta release period we will consider the comments from our testers and release Capr v2 into the <code>main</code> branch of the HADES repo. From there we will provide at least a month for the OHDSI community to test out the package and explore the vignette before pushing subsequent releases.</p>
</section>
<section id="release-roadmap" class="level2">
<h2 class="anchored" data-anchor-id="release-roadmap">Release Roadmap</h2>
<section id="version-2.0-new-and-improved" class="level3">
<h3 class="anchored" data-anchor-id="version-2.0-new-and-improved">Version 2.0 (New and improved)</h3>
<ul>
<li>Updated release of Capr</li>
<li>Alteration to Capr UI, adopting shiny style</li>
<li>Capr constructors for all circe elements</li>
<li>Coercion for all circe elements</li>
<li>Write Capr to json function</li>
<li>‘Hello Capr’ vignette</li>
</ul>
</section>
<section id="version-2.1-finishing-touches-to-v2-base" class="level3">
<h3 class="anchored" data-anchor-id="version-2.1-finishing-touches-to-v2-base">Version 2.1 (finishing touches to v2 base)</h3>
<ul>
<li>Feature Releases:
<ul>
<li>Save/load Capr objects (i.e.&nbsp;query, entry)</li>
<li>Write Capr call and importing json into Capr</li>
</ul></li>
<li>Code Improvements:
<ul>
<li>show methods for Capr objects</li>
<li>more thorough validity checks of Capr objects</li>
<li>helper functions for concept sets
<ul>
<li>handling tibble input of concepts</li>
<li>contextualize concepts via database connection</li>
<li><code>readConceptSet</code>: import concept sets from file (.csv or .json)</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="version-2.2-and-beyond-new-functionality" class="level3">
<h3 class="anchored" data-anchor-id="version-2.2-and-beyond-new-functionality">Version 2.2 and beyond (new functionality)</h3>
<ul>
<li>Describe Functions:
<ul>
<li><code>describe</code>: function to describe cohort definition as markdown text</li>
<li><code>sketch</code>: function to draw cohort figure from definition</li>
</ul></li>
<li>Inquire Functions:
<ul>
<li><code>inquire</code>: with a db, determine how much count is a available for a query or sub-component of cohort defintition</li>
<li>Determine feasibility of adding ohdsisql serialization function</li>
</ul></li>
<li>Modify Functions (Definition Algebra):
<ul>
<li><code>+</code>: add elements (entry, attrition and exit (censor)) of cohort B to cohort A</li>
<li><code>-</code>: subtract elements (entry, attrition and exit (censor)) of cohort B from cohort A</li>
</ul></li>
</ul>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>